{"version":3,"file":"StatusLogger.js","sourceRoot":"","sources":["../../Bootstrap/StatusLogger.ts"],"names":[],"mappings":"AAAA,YAAY,CAAC;;;AAEb,uBAAyB;AACzB,2BAA6B;AAC7B,uBAAyB;AAEzB,2CAAmD;AAanD,SAAS,kBAAkB;IACvB,IAAI,eAAe,GAAG,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE,oBAAoB,CAAC,CAAC;IACpE,IAAI;QACA,IAAI,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,YAAY,CAAC,eAAe,EAAE,MAAM,CAAC,CAAC,CAAC;QACvE,IAAI,WAAW,IAAI,OAAO,WAAW,CAAC,OAAO,KAAK,QAAQ,EAAE;YACxD,OAAO,WAAW,CAAC,OAAO,CAAC;SAC9B;KACJ;IAAC,OAAO,CAAC,EAAE,GAAG;IACf,OAAO,SAAS,CAAC;AACrB,CAAC;AAED;IAaI,sBAAmB,OAAwC;QAAxC,wBAAA,EAAA,iBAAwC;QAAxC,YAAO,GAAP,OAAO,CAAiC;IAAG,CAAC;IAExD,gCAAS,GAAhB,UAAiB,IAAoB,EAAE,EAAyB;QAC5D,IAAI,OAAO,EAAE,KAAK,UAAU,IAAI,IAAI,CAAC,OAAO,YAAY,uBAAU,EAAE;YAChE,IAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,EAAE,CAAC;SAC9B;QACD,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;IAC3B,CAAC;IAnBsB,8BAAiB,GAAW,IAAI,CAAC,IAAI,CAAC,oBAAO,EAAE,QAAQ,CAAC,CAAC;IACzD,8BAAiB,GAAW,YAAU,EAAE,CAAC,QAAQ,EAAE,SAAI,OAAO,CAAC,GAAG,UAAO,CAAC;IAC1E,2BAAc,GAAmB;QACpD,4BAA4B,EAAE,KAAK;QACnC,UAAU,EAAE,KAAK;QACjB,IAAI,EAAE,SAAS;QACf,OAAO,EAAE,SAAS;QAClB,UAAU,EAAE,kBAAkB,EAAE;QAChC,WAAW,EAAE,EAAE,CAAC,QAAQ,EAAE;QAC1B,GAAG,EAAE,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC;KAC3B,CAAA;IAUL,mBAAC;CAAA,AArBD,IAqBC;AArBY,oCAAY","sourcesContent":["\"use strict\";\r\n\r\nimport * as os from \"os\";\r\nimport * as path from \"path\";\r\nimport * as fs from \"fs\";\r\nimport * as DataModel from \"./DataModel\";\r\nimport { FileWriter, homedir } from \"./FileWriter\";\r\n\r\nexport interface StatusContract {\r\n    AgentInitializedSuccessfully: boolean;\r\n    Reason?: string;\r\n    SDKPresent: boolean;\r\n    AppType: string;\r\n    MachineName: string;\r\n    PID: string;\r\n    SdkVersion: string;\r\n    Ikey: string;\r\n}\r\n\r\nfunction readPackageVersion() {\r\n    let packageJsonPath = path.resolve(__dirname, \"../../package.json\");\r\n    try {\r\n        let packageJson = JSON.parse(fs.readFileSync(packageJsonPath, \"utf8\"));\r\n        if (packageJson && typeof packageJson.version === \"string\") {\r\n            return packageJson.version;\r\n        }\r\n    } catch (e) { }\r\n    return \"unknown\";\r\n}\r\n\r\nexport class StatusLogger {\r\n    public static readonly DEFAULT_FILE_PATH: string = path.join(homedir, \"status\");\r\n    public static readonly DEFAULT_FILE_NAME: string = `status_${os.hostname()}_${process.pid}.json`;\r\n    public static readonly DEFAULT_STATUS: StatusContract = {\r\n        AgentInitializedSuccessfully: false,\r\n        SDKPresent: false,\r\n        Ikey: \"unknown\",\r\n        AppType: \"node.js\",\r\n        SdkVersion: readPackageVersion(),\r\n        MachineName: os.hostname(),\r\n        PID: String(process.pid)\r\n    }\r\n\r\n    constructor(public _writer: DataModel.AgentLogger = console) {}\r\n\r\n    public logStatus(data: StatusContract, cb?: (err: Error) => void) {\r\n        if (typeof cb === \"function\" && this._writer instanceof FileWriter) {\r\n            this._writer.callback = cb;\r\n        }\r\n        this._writer.log(data);\r\n    }\r\n}\r\n"]}